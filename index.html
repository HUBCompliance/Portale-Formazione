<!doctype html>
<html lang="it">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduPlatform - Versione Supabase</title>
  <script src="https://cdn.tailwindcss.com/3.3.0"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script><!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-green-50 to-emerald-100 min-h-full"><!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
   <div class="text-center">
    <div class="spinner mx-auto mb-4"></div>
    <p class="text-white text-lg" id="loadingText">Caricamento...</p>
    <p class="text-white text-sm mt-2 opacity-75" id="loadingSubtext">Attendere prego...</p>
   </div>
  </div><!-- Supabase Configuration Modal -->
  <div id="supabaseConfigModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-full overflow-y-auto">
    <div class="p-8">
     <div class="text-center mb-6">
      <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-white text-2xl">âš¡</span>
      </div>
      <h2 class="text-3xl font-bold text-gray-800">Configura Supabase</h2>
      <p class="text-gray-600 mt-2">Solo 2 credenziali - Setup in 5 minuti!</p>
     </div>
     <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
      <h3 class="font-semibold text-green-900 mb-2">ğŸ“‹ Come ottenere le credenziali:</h3>
      <ol class="text-sm text-green-800 space-y-1 ml-4">
       <li>1. Vai su <a href="https://supabase.com" target="_blank" rel="noopener noreferrer" class="underline font-medium">supabase.com</a> e crea account gratis</li>
       <li>2. Clicca <strong>"New Project"</strong></li>
       <li>3. Scegli nome progetto (es: "eduplatform") e password database</li>
       <li>4. Vai su <strong>"Settings"</strong> â†’ <strong>"API"</strong></li>
       <li>5. Copia <code class="bg-green-100 px-1 rounded">Project URL</code> e <code class="bg-green-100 px-1 rounded">anon public</code> key</li>
      </ol>
     </div>
     <form onsubmit="saveSupabaseConfig(event)" class="space-y-4">
      <div><label for="supabaseUrl" class="block text-sm font-medium text-gray-700 mb-1">Project URL</label> <input type="url" id="supabaseUrl" required placeholder="https://tuoprogetto.supabase.co" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
       <p class="text-xs text-gray-500 mt-1">Es: https://xyzabcdef.supabase.co</p>
      </div>
      <div><label for="supabaseKey" class="block text-sm font-medium text-gray-700 mb-1">Anon Public Key</label> <textarea id="supabaseKey" required placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"></textarea>
       <p class="text-xs text-gray-500 mt-1">La chiave pubblica Ã¨ sicura da condividere</p>
      </div>
      <div class="flex space-x-3 pt-4"><button type="submit" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"> âš¡ Connetti Supabase </button>
      </div>
     </form>
     <div class="mt-6 p-3 bg-blue-50 border border-blue-200 rounded-lg">
      <p class="text-xs text-blue-800">ğŸ’¡ <strong>Dopo aver connesso:</strong> Tornerai qui per creare automaticamente le tabelle del database.</p>
     </div>
    </div>
   </div>
  </div><!-- Database Setup Modal -->
  <div id="dbSetupModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
    <div class="p-8">
     <div class="text-center mb-6">
      <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-white text-2xl">ğŸ› ï¸</span>
      </div>
      <h2 class="text-2xl font-bold text-gray-800">Inizializza Database</h2>
      <p class="text-gray-600 mt-2">Crea le tabelle necessarie per la piattaforma</p>
     </div>
     <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
      <p class="text-sm text-yellow-800">âš ï¸ Questa operazione va fatta <strong>solo la prima volta</strong>. Crea 4 tabelle: students, courses, progress, enrollments.</p>
     </div><button onclick="initializeDatabase()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-semibold"> ğŸš€ Crea Tabelle </button> <button onclick="skipDatabaseSetup()" class="w-full mt-3 text-gray-600 hover:text-gray-800 text-sm"> Salta (giÃ  fatto) </button>
    </div>
   </div>
  </div><!-- Navigation -->
  <nav class="bg-white shadow-lg border-b-4 border-green-500">
   <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center py-4">
     <div class="flex items-center space-x-3"><!-- Logo Piattaforma Personalizzato (sinistra) -->
      <div id="platformLogoNavContainer" class="hidden"><img id="platformLogoNav" src="" alt="Logo Piattaforma" class="h-12 object-contain">
      </div><!-- Logo Default (se non c'Ã¨ logo personalizzato) -->
      <div id="defaultLogoContainer" class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center"><span class="text-white font-bold text-lg">ğŸ“</span>
      </div>
      <div>
       <h1 class="text-2xl font-bold text-gray-800">EduPlatform <span class="text-sm text-green-600">âš¡ Supabase</span></h1>
      </div>
     </div>
     <div class="flex items-center space-x-4"><span id="currentUser" class="text-gray-600 font-medium"></span> <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors"> Logout </button>
     </div>
    </div>
   </div>
  </nav><!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
    <div class="text-center mb-8">
     <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-white text-2xl">ğŸ“</span>
     </div>
     <h2 class="text-3xl font-bold text-gray-800">Accedi alla Piattaforma</h2>
     <p class="text-gray-600 mt-2">Database Supabase âš¡</p>
    </div>
    <form onsubmit="login(event)" class="space-y-6">
     <div><label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
     </div>
     <div><label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
     </div><button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition-colors"> Accedi </button>
    </form>
    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
     <p class="text-sm text-gray-600 mb-2"><strong>Credenziali Demo:</strong></p>
     <p class="text-xs text-gray-500">Admin: admin@edu.com / admin123</p>
     <p class="text-xs text-gray-500">Studente: studente@edu.com / student123</p>
    </div>
    <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
     <p class="text-xs text-green-800">âš¡ <strong>Supabase:</strong> PostgreSQL in cloud, piÃ¹ semplice di Firebase!</p>
    </div>
   </div>
  </div><!-- Account Activation Screen -->
  <div id="activationScreen" class="hidden min-h-screen flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
    <div class="text-center mb-8">
     <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-white text-2xl">ğŸ”</span>
     </div>
     <h2 class="text-3xl font-bold text-gray-800">Crea la tua Password</h2>
     <p class="text-gray-600 mt-2">Benvenuto! Imposta la password per il tuo account</p>
    </div>
    <div id="activationInfo" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
     <p class="text-sm text-green-800"><strong>Email:</strong> <span id="activationEmail"></span></p>
     <p class="text-sm text-green-800 mt-1"><strong>Nome:</strong> <span id="activationName"></span></p>
    </div>
    <form onsubmit="activateAccount(event)" class="space-y-6">
     <div><label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">Nuova Password</label> <input type="password" id="newPassword" required minlength="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Minimo 8 caratteri">
      <p class="text-xs text-gray-500 mt-1">La password deve contenere almeno 8 caratteri</p>
     </div>
     <div><label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Conferma Password</label> <input type="password" id="confirmPassword" required minlength="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Ripeti la password">
     </div><button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition-colors"> ğŸ” Attiva Account </button>
    </form>
   </div>
  </div><!-- Main Dashboard -->
  <div id="dashboard" class="hidden"><!-- Admin Dashboard -->
   <div id="adminDashboard" class="hidden max-w-7xl mx-auto p-6">
    <div class="mb-8">
     <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard Amministratore</h2>
     <p class="text-gray-600">Gestisci studenti e corsi - Database Supabase âš¡</p>
    </div><!-- Admin Navigation Tabs -->
    <div class="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg"><button onclick="showAdminTab('students')" id="studentsTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors bg-white text-green-600 shadow-sm"> ğŸ‘¥ Gestione Studenti </button> <button onclick="showAdminTab('companies')" id="companiesTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800"> ğŸ¢ Gestione Aziende </button> <button onclick="showAdminTab('courses')" id="coursesTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800"> ğŸ“š Gestione Corsi </button> <button onclick="showAdminTab('reports')" id="reportsTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800"> ğŸ“Š Report </button> <button onclick="showAdminTab('settings')" id="settingsTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800"> âš™ï¸ Impostazioni </button>
    </div><!-- Students Management -->
    <div id="studentsSection" class="fade-in">
     <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-xl font-semibold text-gray-800">Gestione Studenti</h3>
       <div class="flex space-x-3"><button onclick="downloadExcelTemplate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors"> ğŸ“¥ Scarica Template </button> <button onclick="document.getElementById('excelUpload').click()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors"> ğŸ“¤ Carica Excel </button> <input type="file" id="excelUpload" accept=".xlsx,.xls,.csv" onchange="handleExcelUpload(event)" class="hidden"> <button onclick="showModal('addStudentModal')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors"> â• Aggiungi Singolo </button>
       </div>
      </div>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nome</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Email</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Azienda</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Corsi</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Progresso</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Ruolo</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Stato</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Azioni</th>
         </tr>
        </thead>
        <tbody id="studentsTable" class="divide-y divide-gray-200">
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Companies Management ... [resto del codice invariato] --> **Continua nei prossimi messaggi...** Ho aggiunto nella dashboard amministratore: âœ… **Colonna "Progresso"** - Mostra lo stato di completamento dei corsi per ogni studente âœ… **Badge Stato** - Indica visivamente: - ğŸŸ¢ "Completati" (tutti i corsi finiti) - ğŸ”µ "In Corso" (almeno un corso iniziato) - âšª "Non Iniziati" (nessun corso avviato) âœ… **Barra di Progresso** - Mostra visivamente quanti corsi ha completato (es: 2/5) âœ… **Bottone "Dettagli"** - Per vedere il dettaglio completo del progresso Vuoi che aggiunga anche il modal con i dettagli completi (moduli per modulo di ogni corso)?
   </div>
  </div>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a6c26c0c2f2edce',t:'MTc2NDUyNDY1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
